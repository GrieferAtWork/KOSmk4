{
	"version": "0.2.1",
	"defaults": {
	},
	"configurations": [
		{
			"type": "cppdbg",
			"name": "kernel (--gdb=stub)",
			"inheritEnvironments": [ "${cpp.activeConfiguration}" ],
			"project": "src",
			"sourceFileMap": {
				"ABSOLUTE_KOS_PROJECT_ROOT/kos": "${workspaceRoot}",
				"ABSOLUTE_KOS_PROJECT_ROOT": "${workspaceRoot}\\..",
				"/cygdrive/c": "C:\\",
				"/cygdrive/d": "D:\\",
				"/cygdrive/e": "E:\\",
				"/cygdrive/f": "F:\\",
				"/cygdrive/g": "G:\\"
			},
			"program": "${workspaceRoot}\\..\\bin\\${env.TARGET}-kos-${env.CONFIG}\\os\\kernel.bin",
			"MIMode": "gdb",
			"miDebuggerPath": "gdb.exe",
			"targetArchitecture": "x86",
			"debugType": "native",
			"launchCompleteCommand": "None",
			"miDebuggerServerAddress": "localhost:1234",
			"customLaunchSetupCommands": [
				{ "text": "cd ${workspaceRoot}\\..\\", "ignoreFailures": false },
				{ "text": "set sysroot ${workspaceRoot}\\..\\bin\\${env.TARGET}-kos-${env.CONFIG}", "ignoreFailures": false },
				{ "text": "set solib-search-path bin/${env.TARGET}-kos-${env.CONFIG}/lib:bin/${env.TARGET}-kos-${env.CONFIG}/os/drivers", "ignoreFailures": false },
				{ "text": "set auto-solib-add on", "ignoreFailures": false },
				{ "text": "-target-select remote localhost:1234", "ignoreFailures": false }
			],
			"setupCommands": [
				{ "text": "-enable-pretty-printing", "ignoreFailures": true },
				{ "text": "set print pretty on", "ignoreFailures": true },
				{ "text": "set print object on", "ignoreFailures": true },
				{ "text": "set print static-members on", "ignoreFailures": true },
				{ "text": "set print vtbl on", "ignoreFailures": true },
				{ "text": "set print demangle on", "ignoreFailures": true },
				{ "text": "set demangle-style gnu-v3", "ignoreFailures": true },
				{ "text": "set print sevenbit-strings off", "ignoreFailures": true },
				{ "text": "set detach-on-fork off", "ignoreFailures": false }
			],
			"debugServerPath": "${env.SYSTEMROOT}\\system32\\cmd.exe",
			"debugServerArgs": "/c \"deemon ${workspaceRoot}\\..\\magic.dee --run-only --gdb=stub --emulator-started-pattern=EMULATOR_STARTED --target=${env.TARGET} --config=${env.CONFIG}\"",
			"serverStarted": "EMULATOR_STARTED",
			"serverLaunchTimeout": 120000,
			"filterStdout": true,
			"filterStderr": true
		},
		{
			"type": "cppdbg",
			"name": "kernel (--gdb=stub) (external)",
			"inheritEnvironments": [ "${cpp.activeConfiguration}" ],
			"project": "src",
			"sourceFileMap": {
				"ABSOLUTE_KOS_PROJECT_ROOT/kos": "${workspaceRoot}",
				"ABSOLUTE_KOS_PROJECT_ROOT": "${workspaceRoot}\\..",
				"/cygdrive/c": "C:\\",
				"/cygdrive/d": "D:\\",
				"/cygdrive/e": "E:\\",
				"/cygdrive/f": "F:\\",
				"/cygdrive/g": "G:\\"
			},
			"program": "${workspaceRoot}\\..\\bin\\${env.TARGET}-kos-${env.CONFIG}\\os\\kernel.bin",
			"MIMode": "gdb",
			"miDebuggerPath": "gdb.exe",
			"targetArchitecture": "x86",
			"debugType": "native",
			"launchCompleteCommand": "None",
			"miDebuggerServerAddress": "localhost:1234",
			"customLaunchSetupCommands": [
				{ "text": "cd ${workspaceRoot}\\..\\", "ignoreFailures": false },
				{ "text": "set sysroot ${workspaceRoot}\\..\\bin\\${env.TARGET}-kos-${env.CONFIG}", "ignoreFailures": false },
				{ "text": "set solib-search-path bin/${env.TARGET}-kos-${env.CONFIG}/lib:bin/${env.TARGET}-kos-${env.CONFIG}/os/drivers", "ignoreFailures": false },
				{ "text": "set auto-solib-add on", "ignoreFailures": false },
				{ "text": "-target-select remote localhost:1234", "ignoreFailures": false }
			],
			"setupCommands": [
				{ "text": "-enable-pretty-printing", "ignoreFailures": true },
				{ "text": "set print pretty on", "ignoreFailures": true },
				{ "text": "set print object on", "ignoreFailures": true },
				{ "text": "set print static-members on", "ignoreFailures": true },
				{ "text": "set print vtbl on", "ignoreFailures": true },
				{ "text": "set print demangle on", "ignoreFailures": true },
				{ "text": "set demangle-style gnu-v3", "ignoreFailures": true },
				{ "text": "set print sevenbit-strings off", "ignoreFailures": true },
				{ "text": "set detach-on-fork off", "ignoreFailures": false }
			]
		},
		{
			"type": "cppdbg",
			"name": "kernel (--gdb=qemu)",
			"inheritEnvironments": [ "${cpp.activeConfiguration}" ],
			"project": "src",
			"sourceFileMap": {
				"ABSOLUTE_KOS_PROJECT_ROOT/kos": "${workspaceRoot}",
				"ABSOLUTE_KOS_PROJECT_ROOT": "${workspaceRoot}\\..",
				"/cygdrive/c": "C:\\",
				"/cygdrive/d": "D:\\",
				"/cygdrive/e": "E:\\",
				"/cygdrive/f": "F:\\",
				"/cygdrive/g": "G:\\"
			},
			"program": "${workspaceRoot}\\..\\bin\\${env.TARGET}-kos-${env.CONFIG}\\os\\kernel.bin",
			"MIMode": "gdb",
			"miDebuggerPath": "gdb.exe",
			"targetArchitecture": "x86",
			"debugType": "native",
			"launchCompleteCommand": "None",
			"miDebuggerServerAddress": "localhost:1234",
			"setupCommands": [
				{ "text": "-enable-pretty-printing", "ignoreFailures": true },
				{ "text": "set print pretty on", "ignoreFailures": true },
				{ "text": "set print object on", "ignoreFailures": true },
				{ "text": "set print static-members on", "ignoreFailures": true },
				{ "text": "set print vtbl on", "ignoreFailures": true },
				{ "text": "set print demangle on", "ignoreFailures": true },
				{ "text": "set demangle-style gnu-v3", "ignoreFailures": true },
				{ "text": "set print sevenbit-strings off", "ignoreFailures": true }
			],
			/* Use deemon to start QEMU as the host for the debug server
			 * This functionality isn't actually documented by MS per-se.
			 * As a matter of fact: You won't find any proper documentation
			 * on lauch.vs.json at all on the internet, aside of the little
			 * bit provided by the tooltips within vistual studio.
			 * Anyways: With Visual Studio 2017, you don't need to spend $100
			 *          on VisualGDB in order to be a be able to get Visual
			 *          Studio to connect to a GDB stub and client
			 * Our stub:   Provided by "qemu -s -S"
			 * Our client: Apart of the i386-kos toolchain (any unmodified i386-elf-gdb
			 *             client would do) /binutils/i386-kos/bin/i386-elf-gdb.exe
			 * NOTE: Start deemon via cmd, so-as to allow users any of the
			 *       following methods for providing deemon to our build system:
			 *  - Adding deemon directly to %PATH%
			 *  - Placing a `deemon.cmd' shell-script in %PATH% that redirects to
			 *    deemon (that's what I'm doing; i.e. having one folder containing
			 *    a whole bunch of programs redirected like this)
			 *    >> @echo off
			 *    >> "D:\FULL\PATH\TO\PROGRAM\PROGRAM.exe" %*
			 */
			"debugServerPath": "${env.SYSTEMROOT}\\system32\\cmd.exe",
			"debugServerArgs": "/c \"deemon ${workspaceRoot}\\..\\magic.dee --run-only --gdb=qemu --emulator-started-pattern=EMULATOR_STARTED --target=${env.TARGET} --config=${env.CONFIG}\"",
			"serverStarted": "EMULATOR_STARTED",
			"serverLaunchTimeout": 120000,
			"filterStdout": true,
			"filterStderr": true
		},
		{
			"type": "cppdbg",
			"name": "kernel (--gdb=qemu) (external)",
			"inheritEnvironments": [ "${cpp.activeConfiguration}" ],
			"project": "src",
			"sourceFileMap": {
				"ABSOLUTE_KOS_PROJECT_ROOT/kos": "${workspaceRoot}",
				"ABSOLUTE_KOS_PROJECT_ROOT": "${workspaceRoot}\\..",
				"/cygdrive/c": "C:\\",
				"/cygdrive/d": "D:\\",
				"/cygdrive/e": "E:\\",
				"/cygdrive/f": "F:\\",
				"/cygdrive/g": "G:\\"
			},
			"program": "${workspaceRoot}\\..\\bin\\${env.TARGET}-kos-${env.CONFIG}\\os\\kernel.bin",
			"MIMode": "gdb",
			"miDebuggerPath": "gdb.exe",
			"targetArchitecture": "x86",
			"debugType": "native",
			"launchCompleteCommand": "None",
			"miDebuggerServerAddress": "localhost:1234",
			"setupCommands": [
				{ "text": "-enable-pretty-printing", "ignoreFailures": true },
				{ "text": "set print pretty on", "ignoreFailures": true },
				{ "text": "set print object on", "ignoreFailures": true },
				{ "text": "set print static-members on", "ignoreFailures": true },
				{ "text": "set print vtbl on", "ignoreFailures": true },
				{ "text": "set print demangle on", "ignoreFailures": true },
				{ "text": "set demangle-style gnu-v3", "ignoreFailures": true },
				{ "text": "set print sevenbit-strings off", "ignoreFailures": true }
			]
		}
	]
}
