/* Copyright (c) 2019-2020 Griefer@Work                                       *
 *                                                                            *
 * This software is provided 'as-is', without any express or implied          *
 * warranty. In no event will the authors be held liable for any damages      *
 * arising from the use of this software.                                     *
 *                                                                            *
 * Permission is granted to anyone to use this software for any purpose,      *
 * including commercial applications, and to alter it and redistribute it     *
 * freely, subject to the following restrictions:                             *
 *                                                                            *
 * 1. The origin of this software must not be misrepresented; you must not    *
 *    claim that you wrote the original software. If you use this software    *
 *    in a product, an acknowledgement (see the following) in the product     *
 *    documentation is required:                                              *
 *    Portions Copyright (c) 2019-2020 Griefer@Work                           *
 * 2. Altered source versions must be plainly marked as such, and must not be *
 *    misrepresented as being the original software.                          *
 * 3. This notice may not be removed or altered from any source distribution. *
 */
#ifndef GUARD_LIBVGASTATE_VGASTATE_C
#define GUARD_LIBVGASTATE_VGASTATE_C 1
#define _KOS_SOURCE 1
#define _LARGEFILE64_SOURCE 1

#include "api.h"
/**/

#include <hybrid/atomic.h>

#include <kos/kernel/types.h>
#include <kos/types.h>
#include <sys/io.h>

#include <libvgastate/vga.h>

#include "vgaio.h"
#include "vgastate.h"

#ifdef __KERNEL__
#include <kernel/vm/phys.h>
#else /* __KERNEL__ */
#include <fcntl.h>
#include <unistd.h>
#endif /* !__KERNEL__ */

DECL_BEGIN

#ifndef __KERNEL__
PRIVATE fd_t dev_mem = -1;

#define copyfromphys(/*void **/ dst, src, num_bytes)                 \
	(pread64(dev_mem, dst, num_bytes, (pos64_t)(src)) == (num_bytes) \
	 ? VGA_STATE_ERROR_SUCCESS                                       \
	 : VGA_STATE_ERROR_IO)

#define copytophys(dst, /*void const **/ src, num_bytes)              \
	(pwrite64(dev_mem, src, num_bytes, (pos64_t)(dst)) == (num_bytes) \
	 ? VGA_STATE_ERROR_SUCCESS                                        \
	 : VGA_STATE_ERROR_IO)


PRIVATE WUNUSED unsigned int
NOTHROW_KERNEL(CC init_phys)(void) {
	if (ATOMIC_READ(dev_mem) == -1) {
		fd_t fd;
		fd = open("/dev/mem", O_RDWR);
		if (fd == -1)
			return VGA_STATE_ERROR_ACCES;
		if (!ATOMIC_CMPXCH(dev_mem, -1, fd))
			close(fd);
	}
	return VGA_STATE_ERROR_SUCCESS;

}
#else /* !__KERNEL__ */
#define init_phys() \
	VGA_STATE_ERROR_SUCCESS
#define copyfromphys(/*void **/ dst, src, num_bytes) \
	(vm_copyfromphys(/*void **/ dst, src, num_bytes), VGA_STATE_ERROR_SUCCESS)
#define copytophys(dst, /*void const **/ src, num_bytes) \
	(vm_copytophys(dst, /*void const **/ src, num_bytes), VGA_STATE_ERROR_SUCCESS)
#endif /* __KERNEL__ */



PRIVATE WUNUSED NONNULL((1)) unsigned int
NOTHROW_KERNEL(CC save_vga_mode)(struct vga_mode *__restrict self) {
	unsigned int i;
	vga_r(VGA_IS1_RC), vga_w(VGA_ATT_W, 0x00);
	self->vm_att_mode         = vga_rattr(VGA_ATC_MODE);
	self->vm_att_overscan     = vga_rattr(VGA_ATC_OVERSCAN);
	self->vm_att_plane_enable = vga_rattr(VGA_ATC_PLANE_ENABLE);
	self->vm_att_pel          = vga_rattr(VGA_ATC_PEL);
	self->vm_att_color_page   = vga_rattr(VGA_ATC_COLOR_PAGE);
	for (i = 0; i < 16; ++i) {
		self->vm_att_pal[i] = vga_rattr(VGA_ATC_PALETTE0 + i);
	}
	vga_r(VGA_IS1_RC), vga_w(VGA_ATT_W, 0x20);
	self->vm_mis               = vga_r(VGA_MIS_R);
	self->vm_gfx_sr_value      = vga_rgfx(VGA_GFX_SR_VALUE);
	self->vm_gfx_sr_enable     = vga_rgfx(VGA_GFX_SR_ENABLE);
	self->vm_gfx_compare_value = vga_rgfx(VGA_GFX_COMPARE_VALUE);
	self->vm_gfx_data_rotate   = vga_rgfx(VGA_GFX_DATA_ROTATE);
	self->vm_gfx_plane_read    = vga_rgfx(VGA_GFX_PLANE_READ);
	self->vm_gfx_mode          = vga_rgfx(VGA_GFX_MODE);
	self->vm_gfx_misc          = vga_rgfx(VGA_GFX_MISC);
	self->vm_gfx_compare_mask  = vga_rgfx(VGA_GFX_COMPARE_MASK);
	self->vm_gfx_bit_mask      = vga_rgfx(VGA_GFX_BIT_MASK);
	self->vm_crt_h_total       = vga_rcrt(VGA_CRTC_H_TOTAL);
	self->vm_crt_h_disp        = vga_rcrt(VGA_CRTC_H_DISP);
	self->vm_crt_h_blank_start = vga_rcrt(VGA_CRTC_H_BLANK_START);
	self->vm_crt_h_blank_end   = vga_rcrt(VGA_CRTC_H_BLANK_END);
	self->vm_crt_h_sync_start  = vga_rcrt(VGA_CRTC_H_SYNC_START);
	self->vm_crt_h_sync_end    = vga_rcrt(VGA_CRTC_H_SYNC_END);
	self->vm_crt_v_total       = vga_rcrt(VGA_CRTC_V_TOTAL);
	self->vm_crt_overflow      = vga_rcrt(VGA_CRTC_OVERFLOW);
	self->vm_crt_preset_row    = vga_rcrt(VGA_CRTC_PRESET_ROW);
	self->vm_crt_max_scan      = vga_rcrt(VGA_CRTC_MAX_SCAN);
	self->vm_crt_cursor_start  = vga_rcrt(VGA_CRTC_CURSOR_START);
	self->vm_crt_cursor_end    = vga_rcrt(VGA_CRTC_CURSOR_END);
	self->vm_crt_start_hi      = vga_rcrt(VGA_CRTC_START_HI);
	self->vm_crt_start_lo      = vga_rcrt(VGA_CRTC_START_LO);
	self->vm_crt_cursor_hi     = vga_rcrt(VGA_CRTC_CURSOR_HI);
	self->vm_crt_cursor_lo     = vga_rcrt(VGA_CRTC_CURSOR_LO);
	self->vm_crt_v_sync_start  = vga_rcrt(VGA_CRTC_V_SYNC_START);
	self->vm_crt_v_sync_end    = vga_rcrt(VGA_CRTC_V_SYNC_END);
	self->vm_crt_v_disp_end    = vga_rcrt(VGA_CRTC_V_DISP_END);
	self->vm_crt_offset        = vga_rcrt(VGA_CRTC_OFFSET);
	self->vm_crt_underline     = vga_rcrt(VGA_CRTC_UNDERLINE);
	self->vm_crt_v_blank_start = vga_rcrt(VGA_CRTC_V_BLANK_START);
	self->vm_crt_v_blank_end   = vga_rcrt(VGA_CRTC_V_BLANK_END);
	self->vm_crt_mode          = vga_rcrt(VGA_CRTC_MODE);
	self->vm_crt_line_compare  = vga_rcrt(VGA_CRTC_LINE_COMPARE);
	self->vm_seq_plane_write   = vga_rseq(VGA_SEQ_PLANE_WRITE);
	self->vm_seq_character_map = vga_rseq(VGA_SEQ_CHARACTER_MAP);
	self->vm_seq_memory_mode   = vga_rseq(VGA_SEQ_MEMORY_MODE);
	self->vm_seq_clock_mode    = vga_rseq(VGA_SEQ_CLOCK_MODE);
	return VGA_STATE_ERROR_SUCCESS;
}

PRIVATE WUNUSED NONNULL((1)) unsigned int
NOTHROW_KERNEL(CC load_vga_mode)(struct vga_mode const *__restrict self,
                                 u8 resmask) {
	unsigned int i;

	/* Turn off the screen. */
	{
		u8 qr1 = vga_rseq(VGA_SEQ_CLOCK_MODE);
		vga_wseq(VGA_SEQ_RESET, 0x1);
		vga_wseq(VGA_SEQ_CLOCK_MODE, qr1 | VGA_SR01_FSCREEN_OFF);
		vga_wseq(VGA_SEQ_RESET, 0x3);
	}

	/* Enable graphics mode. */
	vga_r(VGA_IS1_RC), vga_w(VGA_ATT_W, 0x00);
	vga_wattr_res(VGA_ATC_MODE, self->vm_att_mode, VGA_AT10_FRESERVED & resmask);
	vga_wattr(VGA_ATC_OVERSCAN, self->vm_att_overscan);
	vga_wattr_res(VGA_ATC_PLANE_ENABLE, self->vm_att_plane_enable, VGA_AT12_FRESERVED & resmask);
	vga_wattr_res(VGA_ATC_PEL, self->vm_att_pel, VGA_AT13_FRESERVED & resmask);
	vga_wattr_res(VGA_ATC_COLOR_PAGE, self->vm_att_color_page, VGA_AT14_FRESERVED & resmask);
	for (i = 0; i < 16; ++i) {
		vga_wattr_res(VGA_ATC_PALETTE0 + i, self->vm_att_pal[i],
		              VGA_ATC_PALETTEn_FRESERVED & resmask);
	}
	vga_r(VGA_IS1_RC), vga_w(VGA_ATT_W, 0x20);
	vga_w(VGA_MIS_W, self->vm_mis);

	vga_wseq_res(VGA_SEQ_PLANE_WRITE, self->vm_seq_plane_write, VGA_SR02_FRESERVED & resmask);
	vga_wseq_res(VGA_SEQ_CHARACTER_MAP, self->vm_seq_character_map, VGA_SR03_FRESERVED & resmask);
	vga_wseq_res(VGA_SEQ_MEMORY_MODE, self->vm_seq_memory_mode, VGA_SR04_FRESERVED & resmask);

	vga_wgfx_res(VGA_GFX_SR_VALUE, self->vm_gfx_sr_value, VGA_GR00_FRESERVED & resmask);
	vga_wgfx_res(VGA_GFX_SR_ENABLE, self->vm_gfx_sr_enable, VGA_GR01_FRESERVED & resmask);
	vga_wgfx_res(VGA_GFX_COMPARE_VALUE, self->vm_gfx_compare_value, VGA_GR02_FRESERVED & resmask);
	vga_wgfx_res(VGA_GFX_DATA_ROTATE, self->vm_gfx_data_rotate, VGA_GR03_FRESERVED & resmask);
	vga_wgfx_res(VGA_GFX_PLANE_READ, self->vm_gfx_plane_read, VGA_GR04_FRESERVED & resmask);
	vga_wgfx_res(VGA_GFX_MODE, self->vm_gfx_mode, VGA_GR05_FRESERVED & resmask);
	vga_wgfx_res(VGA_GFX_MISC, self->vm_gfx_misc, VGA_GR06_FRESERVED & resmask);
	vga_wgfx_res(VGA_GFX_COMPARE_MASK, self->vm_gfx_compare_mask, VGA_GR07_FRESERVED & resmask);
	vga_wgfx(VGA_GFX_BIT_MASK, self->vm_gfx_bit_mask);

	/* Apply new graphics settings. */
	vga_wcrt(VGA_CRTC_H_TOTAL, self->vm_crt_h_total);
	vga_wcrt(VGA_CRTC_H_DISP, self->vm_crt_h_disp);
	vga_wcrt(VGA_CRTC_H_BLANK_START, self->vm_crt_h_blank_start);
	vga_wcrt(VGA_CRTC_H_BLANK_END, self->vm_crt_h_blank_end | (VGA_CR3_FALWAYS1 & resmask));
	vga_wcrt(VGA_CRTC_H_SYNC_START, self->vm_crt_h_sync_start);
	vga_wcrt(VGA_CRTC_H_SYNC_END, self->vm_crt_h_sync_end);
	vga_wcrt(VGA_CRTC_V_TOTAL, self->vm_crt_v_total);
	vga_wcrt(VGA_CRTC_OVERFLOW, self->vm_crt_overflow);
	vga_wcrt_res(VGA_CRTC_PRESET_ROW, self->vm_crt_preset_row, VGA_CR8_FRESERVED & resmask);
	vga_wcrt(VGA_CRTC_MAX_SCAN, self->vm_crt_max_scan);
	vga_wcrt_res(VGA_CRTC_CURSOR_START, self->vm_crt_cursor_start, VGA_CRA_FRESERVED & resmask);
	vga_wcrt_res(VGA_CRTC_CURSOR_END, self->vm_crt_cursor_end, VGA_CRB_FRESERVED & resmask);
	vga_wcrt(VGA_CRTC_START_HI, self->vm_crt_start_hi);
	vga_wcrt(VGA_CRTC_START_LO, self->vm_crt_start_lo);
	vga_wcrt(VGA_CRTC_CURSOR_HI, self->vm_crt_cursor_hi);
	vga_wcrt(VGA_CRTC_CURSOR_LO, self->vm_crt_cursor_lo);
	vga_wcrt(VGA_CRTC_V_SYNC_START, self->vm_crt_v_sync_start);
	vga_wcrt_res(VGA_CRTC_V_SYNC_END, self->vm_crt_v_sync_end, VGA_CR11_FRESERVED & resmask);
	vga_wcrt(VGA_CRTC_V_DISP_END, self->vm_crt_v_disp_end);
	vga_wcrt(VGA_CRTC_OFFSET, self->vm_crt_offset);
	vga_wcrt(VGA_CRTC_UNDERLINE, self->vm_crt_underline);
	vga_wcrt(VGA_CRTC_V_BLANK_START, self->vm_crt_v_blank_start);
	vga_wcrt_res(VGA_CRTC_V_BLANK_END, self->vm_crt_v_blank_end, VGA_CR16_FRESERVED & resmask);
	vga_wcrt_res(VGA_CRTC_MODE, self->vm_crt_mode, VGA_CR17_FRESERVED & resmask);
	vga_wcrt(VGA_CRTC_LINE_COMPARE, self->vm_crt_line_compare);

	/* Turn the screen back on. */
	vga_wseq(VGA_SEQ_RESET, 0x1);
	vga_wseq(VGA_SEQ_CLOCK_MODE, self->vm_seq_clock_mode);
	vga_wseq(VGA_SEQ_RESET, 0x3);
	return VGA_STATE_ERROR_SUCCESS;
}


struct vga_font_access_regs {
	u8 old_seq_plane_write;
	u8 old_seq_memory_mode;
	u8 old_gfx_plane_read;
	u8 old_gfx_mode;
	u8 old_gfx_misc;
};

PRIVATE NONNULL((1)) void
NOTHROW_KERNEL(CC begin_vga_font_access)(struct vga_font_access_regs *__restrict regs) {
	regs->old_seq_plane_write = vga_rseq(VGA_SEQ_PLANE_WRITE);
	regs->old_seq_memory_mode = vga_rseq(VGA_SEQ_MEMORY_MODE);
	regs->old_gfx_plane_read  = vga_rgfx(VGA_GFX_PLANE_READ);
	regs->old_gfx_mode        = vga_rgfx(VGA_GFX_MODE);
	regs->old_gfx_misc        = vga_rgfx(VGA_GFX_MISC);
	vga_wseq(VGA_SEQ_PLANE_WRITE, (regs->old_seq_plane_write & VGA_SR02_FRESERVED) | VGA_SR02_FPLANE(2));
	vga_wseq(VGA_SEQ_MEMORY_MODE, (regs->old_seq_memory_mode & VGA_SR04_FRESERVED) |
	                              (VGA_SR04_FEXT_MEM | VGA_SR04_FSEQ_MODE));
	vga_wgfx(VGA_GFX_PLANE_READ, (regs->old_gfx_plane_read & VGA_GR04_FRESERVED) | 0x02);
	vga_wgfx(VGA_GFX_MODE, (regs->old_gfx_mode & VGA_GR05_FRESERVED) | 0x00);
	vga_wgfx(VGA_GFX_MISC, (regs->old_gfx_misc & VGA_GR06_FRESERVED) |
	                       (VGA_GR06_FGRAPHICS_MODE | VGA_GR06_FMM_64K));
}

PRIVATE NONNULL((1)) void
NOTHROW_KERNEL(CC end_vga_font_access)(struct vga_font_access_regs *__restrict regs) {
	vga_wseq(VGA_SEQ_PLANE_WRITE, regs->old_seq_plane_write);
	vga_wseq(VGA_SEQ_MEMORY_MODE, regs->old_seq_memory_mode);
	vga_wgfx(VGA_GFX_PLANE_READ, regs->old_gfx_plane_read);
	vga_wgfx(VGA_GFX_MODE, regs->old_gfx_mode);
	vga_wgfx(VGA_GFX_MISC, regs->old_gfx_misc);
}

PRIVATE WUNUSED NONNULL((1)) unsigned int
NOTHROW_KERNEL(CC save_vga_font)(struct vga_font *__restrict self) {
	unsigned int i, result;
	struct vga_font_access_regs regs;
	u32 src = 0;
	begin_vga_font_access(&regs);
	result = VGA_STATE_ERROR_SUCCESS;
	for (i = 0; i < 256; ++i) {
		result = copyfromphys(&self->vf_blob[i], VGA_VRAM_BASE + src, 16);
		if unlikely(result != VGA_STATE_ERROR_SUCCESS)
			break;
		src += 32;
	}
	end_vga_font_access(&regs);
	return result;
}

PRIVATE WUNUSED NONNULL((1)) unsigned int
NOTHROW_KERNEL(CC load_vga_font)(struct vga_font const *__restrict self) {
	unsigned int i, result;
	struct vga_font_access_regs regs;
	u32 src = 0;
	begin_vga_font_access(&regs);
	result = VGA_STATE_ERROR_SUCCESS;
	for (i = 0; i < 256; ++i) {
		result = copytophys(VGA_VRAM_BASE + src, &self->vf_blob[i], 16);
		if unlikely(result != VGA_STATE_ERROR_SUCCESS)
			break;
		src += 32;
	}
	end_vga_font_access(&regs);
	return result;
}

PRIVATE WUNUSED NONNULL((1)) unsigned int
NOTHROW_KERNEL(CC save_vga_palette)(struct vga_color *__restrict pal,
                                    size_t num_bytes) {
	unsigned int i;
	vga_w(VGA_PEL_MSK, 0xff);
	vga_w(VGA_PEL_IR, 0x00);
	for (i = 0; i < num_bytes; ++i)
		((byte_t *)pal)[i] = vga_r(VGA_PEL_D);
	for (; i < 768; ++i)
		vga_r(VGA_PEL_D);
	return VGA_STATE_ERROR_SUCCESS;
}

PRIVATE WUNUSED NONNULL((1)) unsigned int
NOTHROW_KERNEL(CC load_vga_palette)(struct vga_color const *__restrict pal,
                                    size_t num_bytes) {
	unsigned int i;
	vga_w(VGA_PEL_MSK, 0xff);
	vga_w(VGA_PEL_IW, 0x00);
	for (i = 0; i < num_bytes; ++i)
		vga_w(VGA_PEL_D, ((byte_t *)pal)[i]);
	for (; i < 768; ++i)
		vga_w(VGA_PEL_D, 0);
	return VGA_STATE_ERROR_SUCCESS;
}

struct vga_text_access_regs {
	u8 old_seq_memory_mode;
	u8 old_gfx_plane_read;
	u8 old_gfx_mode;
	u8 old_gfx_misc;
};

PRIVATE NONNULL((1)) void
NOTHROW_KERNEL(CC begin_vga_text_access)(struct vga_text_access_regs *__restrict regs) {
	regs->old_seq_memory_mode = vga_rseq(VGA_SEQ_MEMORY_MODE);
	regs->old_gfx_plane_read  = vga_rgfx(VGA_GFX_PLANE_READ);
	regs->old_gfx_mode        = vga_rgfx(VGA_GFX_MODE);
	regs->old_gfx_misc        = vga_rgfx(VGA_GFX_MISC);

	/* Re-configure VGA so we can access what will eventually become text memory. */
	vga_wseq(VGA_SEQ_MEMORY_MODE,
	         (regs->old_seq_memory_mode & VGA_SR04_FRESERVED) |
	         VGA_SR04_FEXT_MEM);
	vga_wgfx(VGA_GFX_PLANE_READ,
	         (regs->old_gfx_plane_read & VGA_GR04_FRESERVED) |
	         VGA_GR04_READMAP(0));
	vga_wgfx(VGA_GFX_MODE,
	         (regs->old_gfx_mode & VGA_GR05_FRESERVED) |
	         VGA_GR05_FWRITEMODE_0 | VGA_GR05_FREADMODE_0 | VGA_GR05_FHOSTOE);
	vga_wgfx(VGA_GFX_MISC,
	         (regs->old_gfx_misc & VGA_GR06_FRESERVED) |
	         VGA_GR06_FTEXT_MODE | VGA_GR06_FCHAINOE | VGA_GR06_FMM_32K_HI);
}

PRIVATE NONNULL((1)) void
NOTHROW_KERNEL(CC end_vga_text_access)(struct vga_text_access_regs const *__restrict regs) {
	/* Restore VGA registers. */
	vga_wseq(VGA_SEQ_MEMORY_MODE, regs->old_seq_memory_mode);
	vga_wgfx(VGA_GFX_PLANE_READ, regs->old_gfx_plane_read);
	vga_wgfx(VGA_GFX_MODE, regs->old_gfx_mode);
	vga_wgfx(VGA_GFX_MISC, regs->old_gfx_misc);
}

PRIVATE WUNUSED NONNULL((1)) unsigned int
NOTHROW_KERNEL(CC save_vga_text)(u16 textbuf[80 * 25]) {
	unsigned int result;
	struct vga_text_access_regs regs;
	begin_vga_text_access(&regs);

	/* Save old text memory. */
	result = copyfromphys(textbuf, VGA_VRAM_TEXT, 80 * 25 * 2);

	end_vga_text_access(&regs);
	return result;
}

PRIVATE WUNUSED NONNULL((1)) unsigned int
NOTHROW_KERNEL(CC load_vga_text)(u16 const textbuf[80 * 25]) {
	unsigned int result;
	struct vga_text_access_regs regs;
	begin_vga_text_access(&regs);

	/* Save old text memory. */
	result = copytophys(VGA_VRAM_TEXT, textbuf, 80 * 25 * 2);

	end_vga_text_access(&regs);
	return result;
}





INTERN NONNULL((1)) unsigned int
NOTHROW_KERNEL(CC libvga_state_save)(struct vga_state *__restrict self) {
	unsigned int result;
	result = init_phys();
	if unlikely(result != VGA_STATE_ERROR_SUCCESS)
		goto done;
	result = save_vga_mode(&self->vs_mode);
	if unlikely(result != VGA_STATE_ERROR_SUCCESS)
		goto done;
	result = save_vga_palette(&self->vs_pal.vp_pal[0], sizeof(self->vs_pal.vp_pal));
	if unlikely(result != VGA_STATE_ERROR_SUCCESS)
		goto done;
	result = save_vga_font(&self->vs_font);
	if unlikely(result != VGA_STATE_ERROR_SUCCESS)
		goto done;
	result = save_vga_text(self->vs_text);
	if unlikely(result != VGA_STATE_ERROR_SUCCESS)
		goto done;
	/* TODO: VESA, etc. */
done:
	return result;
}

INTERN NONNULL((1)) unsigned int
NOTHROW_KERNEL(CC libvga_state_load)(struct vga_state const *__restrict self) {
	unsigned int result;
	result = init_phys();
	if unlikely(result != VGA_STATE_ERROR_SUCCESS)
		goto done;
	result = load_vga_text(self->vs_text);
	if unlikely(result != VGA_STATE_ERROR_SUCCESS)
		goto done;
	result = load_vga_font(&self->vs_font);
	if unlikely(result != VGA_STATE_ERROR_SUCCESS)
		goto done;
	result = load_vga_palette(&self->vs_pal.vp_pal[0], sizeof(self->vs_pal.vp_pal));
	if unlikely(result != VGA_STATE_ERROR_SUCCESS)
		goto done;
	result = load_vga_mode(&self->vs_mode, 0x00);
	if unlikely(result != VGA_STATE_ERROR_SUCCESS)
		goto done;
	/* TODO: VESA, etc. */
done:
	return result;
}

INTERN NONNULL((1)) void
NOTHROW_KERNEL(CC libvga_state_fini)(struct vga_state const *__restrict self) {
	(void)self;
	/* TODO: VESA, etc. */
}




/* DISCLAIMER: This font data has been generated from univga:
 * https://star.inp.nsk.su/~bolkhov/files/fonts/univga/ */
PRIVATE struct vga_mode const textmode =
VGA_BIOTEXT80x25_MODE_INIT(VGA_PALINDX_CGA_ANSI_INIT);

PRIVATE struct vga_palette16 const textpal =
VGA_PALETTE_CGA_INIT;

PRIVATE struct vga_font const textfont = {{
/*[[[deemon
local CP437 = {
	0x0000, 0x263a, 0x263b, 0x2665, 0x2666, 0x2663, 0x2660, 0x2022,
	0x25d8, 0x25cb, 0x25d9, 0x2642, 0x2640, 0x266a, 0x266b, 0x263c,
	0x25ba, 0x25c4, 0x2195, 0x203c, 0x00b6, 0x00a7, 0x25ac, 0x21a8,
	0x2191, 0x2193, 0x2192, 0x2190, 0x221f, 0x2194, 0x25b2, 0x25bc,
	0x0020, 0x0021, 0x0022, 0x0023, 0x0024, 0x0025, 0x0026, 0x0027,
	0x0028, 0x0029, 0x002a, 0x002b, 0x002c, 0x002d, 0x002e, 0x002f,
	0x0030, 0x0031, 0x0032, 0x0033, 0x0034, 0x0035, 0x0036, 0x0037,
	0x0038, 0x0039, 0x003a, 0x003b, 0x003c, 0x003d, 0x003e, 0x003f,
	0x0040, 0x0041, 0x0042, 0x0043, 0x0044, 0x0045, 0x0046, 0x0047,
	0x0048, 0x0049, 0x004a, 0x004b, 0x004c, 0x004d, 0x004e, 0x004f,
	0x0050, 0x0051, 0x0052, 0x0053, 0x0054, 0x0055, 0x0056, 0x0057,
	0x0058, 0x0059, 0x005a, 0x005b, 0x005c, 0x005d, 0x005e, 0x005f,
	0x0060, 0x0061, 0x0062, 0x0063, 0x0064, 0x0065, 0x0066, 0x0067,
	0x0068, 0x0069, 0x006a, 0x006b, 0x006c, 0x006d, 0x006e, 0x006f,
	0x0070, 0x0071, 0x0072, 0x0073, 0x0074, 0x0075, 0x0076, 0x0077,
	0x0078, 0x0079, 0x007a, 0x007b, 0x007c, 0x007d, 0x007e, 0x2302,
	0x00c7, 0x00fc, 0x00e9, 0x00e2, 0x00e4, 0x00e0, 0x00e5, 0x00e7,
	0x00ea, 0x00eb, 0x00e8, 0x00ef, 0x00ee, 0x00ec, 0x00c4, 0x00c5,
	0x00c9, 0x00e6, 0x00c6, 0x00f4, 0x00f6, 0x00f2, 0x00fb, 0x00f9,
	0x00ff, 0x00d6, 0x00dc, 0x00a2, 0x00a3, 0x00a5, 0x20a7, 0x0192,
	0x00e1, 0x00ed, 0x00f3, 0x00fa, 0x00f1, 0x00d1, 0x00aa, 0x00ba,
	0x00bf, 0x2310, 0x00ac, 0x00bd, 0x00bc, 0x00a1, 0x00ab, 0x00bb,
	0x2591, 0x2592, 0x2593, 0x2502, 0x2524, 0x2561, 0x2562, 0x2556,
	0x2555, 0x2563, 0x2551, 0x2557, 0x255d, 0x255c, 0x255b, 0x2510,
	0x2514, 0x2534, 0x252c, 0x251c, 0x2500, 0x253c, 0x255e, 0x255f,
	0x255a, 0x2554, 0x2569, 0x2566, 0x2560, 0x2550, 0x256c, 0x2567,
	0x2568, 0x2564, 0x2565, 0x2559, 0x2558, 0x2552, 0x2553, 0x256b,
	0x256a, 0x2518, 0x250c, 0x2588, 0x2584, 0x258c, 0x2590, 0x2580,
	0x03b1, 0x00df, 0x0393, 0x03c0, 0x03a3, 0x03c3, 0x00b5, 0x03c4,
	0x03a6, 0x0398, 0x03a9, 0x03b4, 0x221e, 0x03c6, 0x03b5, 0x2229,
	0x2261, 0x00b1, 0x2265, 0x2264, 0x2320, 0x2321, 0x00f7, 0x2248,
	0x00b0, 0x2219, 0x00b7, 0x221a, 0x207f, 0x00b2, 0x25a0, 0x00a0,
};

import * from deemon;
import * from ...misc.libtlft.compiler;

local tlft;
with (local fp = File.open("../../misc/fonts/tlft/uni_vga/u_vga16.bdf"))
	tlft = tlftParseBDF(fp);
for (local i: [:256]) {
	local ord = CP437[i];
	local bytes = tlft.map.get(ord);
	if (bytes is none)
		bytes = Bytes(16, 0);
	if (#bytes != 16)
		bytes = bytes.resized(16);
	print("\t{ "),;
	local isFirst = true;
	for (local b: bytes) {
		if (!isFirst)
			print(", "),;
		print("0x", b.hex()[2:].zfill(2)),;
		isFirst = false;
	}
	print(" }, /" "* ", (ord <= 0x1f ? repr(string.chr(ord)) : string.chr(ord)), " *" "/");
}
]]]*/
	{ 0x00, 0x00, 0xda, 0x02, 0x80, 0x82, 0x02, 0x80, 0x82, 0x02, 0x80, 0xb6, 0x00, 0x00, 0x00, 0x00 }, /* "\0" */
	{ 0x00, 0x00, 0x7e, 0x81, 0xa5, 0x81, 0x81, 0xa5, 0x99, 0x81, 0x81, 0x7e, 0x00, 0x00, 0x00, 0x00 }, /* ☺ */
	{ 0x00, 0x00, 0x7e, 0xff, 0xdb, 0xff, 0xff, 0xdb, 0xe7, 0xff, 0xff, 0x7e, 0x00, 0x00, 0x00, 0x00 }, /* ☻ */
	{ 0x00, 0x00, 0x00, 0x00, 0x6c, 0xfe, 0xfe, 0xfe, 0xfe, 0x7c, 0x38, 0x10, 0x00, 0x00, 0x00, 0x00 }, /* ♥ */
	{ 0x00, 0x00, 0x00, 0x00, 0x10, 0x38, 0x7c, 0xfe, 0x7c, 0x38, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ♦ */
	{ 0x00, 0x00, 0x00, 0x18, 0x3c, 0x3c, 0xe7, 0xe7, 0xe7, 0x18, 0x18, 0x3c, 0x00, 0x00, 0x00, 0x00 }, /* ♣ */
	{ 0x00, 0x00, 0x00, 0x18, 0x3c, 0x7e, 0xff, 0xff, 0x7e, 0x18, 0x18, 0x3c, 0x00, 0x00, 0x00, 0x00 }, /* ♠ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x3c, 0x3c, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* • */
	{ 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe7, 0xc3, 0xc3, 0xe7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }, /* ◘ */
	{ 0x00, 0x00, 0x3c, 0x42, 0x81, 0x81, 0x81, 0x81, 0x81, 0x81, 0x42, 0x3c, 0x00, 0x00, 0x00, 0x00 }, /* ○ */
	{ 0xff, 0xff, 0xc3, 0xbd, 0x7e, 0x7e, 0x7e, 0x7e, 0x7e, 0x7e, 0xbd, 0xc3, 0xff, 0xff, 0xff, 0xff }, /* ◙ */
	{ 0x00, 0x00, 0x1e, 0x06, 0x0e, 0x1a, 0x78, 0xcc, 0xcc, 0xcc, 0xcc, 0x78, 0x00, 0x00, 0x00, 0x00 }, /* ♂ */
	{ 0x00, 0x00, 0x3c, 0x66, 0x66, 0x66, 0x66, 0x3c, 0x18, 0x7e, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00 }, /* ♀ */
	{ 0x00, 0x00, 0x30, 0x3c, 0x3e, 0x32, 0x30, 0x30, 0x30, 0x70, 0xf0, 0xe0, 0x00, 0x00, 0x00, 0x00 }, /* ♪ */
	{ 0x00, 0x00, 0x70, 0x7f, 0x6f, 0x63, 0x63, 0x63, 0x63, 0xe3, 0xe7, 0xc7, 0x06, 0x00, 0x00, 0x00 }, /* ♫ */
	{ 0x00, 0x00, 0x00, 0x10, 0x10, 0x54, 0x28, 0xc6, 0x28, 0x54, 0x10, 0x10, 0x00, 0x00, 0x00, 0x00 }, /* ☼ */
	{ 0x00, 0x00, 0x00, 0x00, 0x80, 0xe0, 0xf8, 0xfe, 0xf8, 0xe0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ► */
	{ 0x00, 0x00, 0x00, 0x00, 0x02, 0x0e, 0x3e, 0xfe, 0x3e, 0x0e, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ◄ */
	{ 0x00, 0x00, 0x18, 0x3c, 0x7e, 0x18, 0x18, 0x18, 0x7e, 0x3c, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ↕ */
	{ 0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x00, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00 }, /* ‼ */
	{ 0x00, 0x00, 0x7f, 0xdb, 0xdb, 0xdb, 0x7b, 0x1b, 0x1b, 0x1b, 0x1b, 0x1b, 0x00, 0x00, 0x00, 0x00 }, /* ¶ */
	{ 0x00, 0x7c, 0xc6, 0x60, 0x38, 0x6c, 0xc6, 0xc6, 0x6c, 0x38, 0x0c, 0xc6, 0x7c, 0x00, 0x00, 0x00 }, /* § */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0x00, 0x00, 0x00, 0x00 }, /* ▬ */
	{ 0x00, 0x00, 0x18, 0x3c, 0x7e, 0x18, 0x18, 0x18, 0x7e, 0x3c, 0x18, 0x7e, 0x00, 0x00, 0x00, 0x00 }, /* ↨ */
	{ 0x00, 0x00, 0x18, 0x3c, 0x7e, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00 }, /* ↑ */
	{ 0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x7e, 0x3c, 0x18, 0x00, 0x00, 0x00, 0x00 }, /* ↓ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x06, 0xff, 0x06, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* → */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x60, 0xff, 0x60, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ← */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xfe, 0x00, 0x00, 0x00, 0x00 }, /* ∟ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x66, 0xff, 0x66, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ↔ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x38, 0x38, 0x7c, 0x7c, 0xfe, 0xfe, 0x00, 0x00, 0x00, 0x00 }, /* ▲ */
	{ 0x00, 0x00, 0xfe, 0xfe, 0x7c, 0x7c, 0x38, 0x38, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ▼ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /*   */
	{ 0x00, 0x00, 0x18, 0x3c, 0x3c, 0x3c, 0x18, 0x18, 0x18, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00 }, /* ! */
	{ 0x00, 0x66, 0x66, 0x66, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* " */
	{ 0x00, 0x00, 0x00, 0x6c, 0x6c, 0xfe, 0x6c, 0x6c, 0x6c, 0xfe, 0x6c, 0x6c, 0x00, 0x00, 0x00, 0x00 }, /* # */
	{ 0x18, 0x18, 0x7c, 0xc6, 0xc2, 0xc0, 0x7c, 0x06, 0x06, 0x86, 0xc6, 0x7c, 0x18, 0x18, 0x00, 0x00 }, /* $ */
	{ 0x00, 0x00, 0x00, 0x00, 0xc2, 0xc6, 0x0c, 0x18, 0x30, 0x60, 0xc6, 0x86, 0x00, 0x00, 0x00, 0x00 }, /* % */
	{ 0x00, 0x00, 0x38, 0x6c, 0x6c, 0x38, 0x76, 0xdc, 0xcc, 0xcc, 0xcc, 0x76, 0x00, 0x00, 0x00, 0x00 }, /* & */
	{ 0x00, 0x30, 0x30, 0x30, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ' */
	{ 0x00, 0x00, 0x0c, 0x18, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x18, 0x0c, 0x00, 0x00, 0x00, 0x00 }, /* ( */
	{ 0x00, 0x00, 0x30, 0x18, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x18, 0x30, 0x00, 0x00, 0x00, 0x00 }, /* ) */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x66, 0x3c, 0xff, 0x3c, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* * */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x7e, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* + */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x18, 0x30, 0x00, 0x00, 0x00 }, /* , */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* - */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00 }, /* . */
	{ 0x00, 0x00, 0x00, 0x00, 0x02, 0x06, 0x0c, 0x18, 0x30, 0x60, 0xc0, 0x80, 0x00, 0x00, 0x00, 0x00 }, /* / */
	{ 0x00, 0x00, 0x38, 0x6c, 0xc6, 0xc6, 0xd6, 0xd6, 0xc6, 0xc6, 0x6c, 0x38, 0x00, 0x00, 0x00, 0x00 }, /* 0 */
	{ 0x00, 0x00, 0x18, 0x38, 0x78, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x7e, 0x00, 0x00, 0x00, 0x00 }, /* 1 */
	{ 0x00, 0x00, 0x7c, 0xc6, 0x06, 0x0c, 0x18, 0x30, 0x60, 0xc0, 0xc6, 0xfe, 0x00, 0x00, 0x00, 0x00 }, /* 2 */
	{ 0x00, 0x00, 0x7c, 0xc6, 0x06, 0x06, 0x3c, 0x06, 0x06, 0x06, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* 3 */
	{ 0x00, 0x00, 0x0c, 0x1c, 0x3c, 0x6c, 0xcc, 0xfe, 0x0c, 0x0c, 0x0c, 0x1e, 0x00, 0x00, 0x00, 0x00 }, /* 4 */
	{ 0x00, 0x00, 0xfe, 0xc0, 0xc0, 0xc0, 0xfc, 0x06, 0x06, 0x06, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* 5 */
	{ 0x00, 0x00, 0x38, 0x60, 0xc0, 0xc0, 0xfc, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* 6 */
	{ 0x00, 0x00, 0xfe, 0xc6, 0x06, 0x06, 0x0c, 0x18, 0x30, 0x30, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00 }, /* 7 */
	{ 0x00, 0x00, 0x7c, 0xc6, 0xc6, 0xc6, 0x7c, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* 8 */
	{ 0x00, 0x00, 0x7c, 0xc6, 0xc6, 0xc6, 0x7e, 0x06, 0x06, 0x06, 0x0c, 0x78, 0x00, 0x00, 0x00, 0x00 }, /* 9 */
	{ 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* : */
	{ 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x18, 0x18, 0x30, 0x00, 0x00, 0x00, 0x00 }, /* ; */
	{ 0x00, 0x00, 0x00, 0x06, 0x0c, 0x18, 0x30, 0x60, 0x30, 0x18, 0x0c, 0x06, 0x00, 0x00, 0x00, 0x00 }, /* < */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* = */
	{ 0x00, 0x00, 0x00, 0x60, 0x30, 0x18, 0x0c, 0x06, 0x0c, 0x18, 0x30, 0x60, 0x00, 0x00, 0x00, 0x00 }, /* > */
	{ 0x00, 0x00, 0x7c, 0xc6, 0xc6, 0x0c, 0x18, 0x18, 0x18, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00 }, /* ? */
	{ 0x00, 0x00, 0x00, 0x7c, 0xc6, 0xc6, 0xde, 0xde, 0xde, 0xdc, 0xc0, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* @ */
	{ 0x00, 0x00, 0x10, 0x38, 0x6c, 0xc6, 0xc6, 0xfe, 0xc6, 0xc6, 0xc6, 0xc6, 0x00, 0x00, 0x00, 0x00 }, /* A */
	{ 0x00, 0x00, 0xfc, 0x66, 0x66, 0x66, 0x7c, 0x66, 0x66, 0x66, 0x66, 0xfc, 0x00, 0x00, 0x00, 0x00 }, /* B */
	{ 0x00, 0x00, 0x3c, 0x66, 0xc2, 0xc0, 0xc0, 0xc0, 0xc0, 0xc2, 0x66, 0x3c, 0x00, 0x00, 0x00, 0x00 }, /* C */
	{ 0x00, 0x00, 0xf8, 0x6c, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x6c, 0xf8, 0x00, 0x00, 0x00, 0x00 }, /* D */
	{ 0x00, 0x00, 0xfe, 0x66, 0x62, 0x68, 0x78, 0x68, 0x60, 0x62, 0x66, 0xfe, 0x00, 0x00, 0x00, 0x00 }, /* E */
	{ 0x00, 0x00, 0xfe, 0x66, 0x62, 0x68, 0x78, 0x68, 0x60, 0x60, 0x60, 0xf0, 0x00, 0x00, 0x00, 0x00 }, /* F */
	{ 0x00, 0x00, 0x3c, 0x66, 0xc2, 0xc0, 0xc0, 0xde, 0xc6, 0xc6, 0x66, 0x3a, 0x00, 0x00, 0x00, 0x00 }, /* G */
	{ 0x00, 0x00, 0xc6, 0xc6, 0xc6, 0xc6, 0xfe, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x00, 0x00, 0x00, 0x00 }, /* H */
	{ 0x00, 0x00, 0x3c, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x00, 0x00, 0x00, 0x00 }, /* I */
	{ 0x00, 0x00, 0x1e, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0xcc, 0xcc, 0xcc, 0x78, 0x00, 0x00, 0x00, 0x00 }, /* J */
	{ 0x00, 0x00, 0xe6, 0x66, 0x66, 0x6c, 0x78, 0x78, 0x6c, 0x66, 0x66, 0xe6, 0x00, 0x00, 0x00, 0x00 }, /* K */
	{ 0x00, 0x00, 0xf0, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x62, 0x66, 0xfe, 0x00, 0x00, 0x00, 0x00 }, /* L */
	{ 0x00, 0x00, 0xc6, 0xee, 0xfe, 0xfe, 0xd6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x00, 0x00, 0x00, 0x00 }, /* M */
	{ 0x00, 0x00, 0xc6, 0xe6, 0xf6, 0xfe, 0xde, 0xce, 0xc6, 0xc6, 0xc6, 0xc6, 0x00, 0x00, 0x00, 0x00 }, /* N */
	{ 0x00, 0x00, 0x7c, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* O */
	{ 0x00, 0x00, 0xfc, 0x66, 0x66, 0x66, 0x7c, 0x60, 0x60, 0x60, 0x60, 0xf0, 0x00, 0x00, 0x00, 0x00 }, /* P */
	{ 0x00, 0x00, 0x7c, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xd6, 0xde, 0x7c, 0x0c, 0x0e, 0x00, 0x00 }, /* Q */
	{ 0x00, 0x00, 0xfc, 0x66, 0x66, 0x66, 0x7c, 0x6c, 0x66, 0x66, 0x66, 0xe6, 0x00, 0x00, 0x00, 0x00 }, /* R */
	{ 0x00, 0x00, 0x7c, 0xc6, 0xc6, 0x60, 0x38, 0x0c, 0x06, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* S */
	{ 0x00, 0x00, 0x7e, 0x7e, 0x5a, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x00, 0x00, 0x00, 0x00 }, /* T */
	{ 0x00, 0x00, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* U */
	{ 0x00, 0x00, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x6c, 0x38, 0x10, 0x00, 0x00, 0x00, 0x00 }, /* V */
	{ 0x00, 0x00, 0xc6, 0xc6, 0xc6, 0xc6, 0xd6, 0xd6, 0xd6, 0xfe, 0xee, 0x6c, 0x00, 0x00, 0x00, 0x00 }, /* W */
	{ 0x00, 0x00, 0xc6, 0xc6, 0x6c, 0x7c, 0x38, 0x38, 0x7c, 0x6c, 0xc6, 0xc6, 0x00, 0x00, 0x00, 0x00 }, /* X */
	{ 0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x3c, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x00, 0x00, 0x00, 0x00 }, /* Y */
	{ 0x00, 0x00, 0xfe, 0xc6, 0x86, 0x0c, 0x18, 0x30, 0x60, 0xc2, 0xc6, 0xfe, 0x00, 0x00, 0x00, 0x00 }, /* Z */
	{ 0x00, 0x00, 0x3c, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3c, 0x00, 0x00, 0x00, 0x00 }, /* [ */
	{ 0x00, 0x00, 0x00, 0x80, 0xc0, 0xe0, 0x70, 0x38, 0x1c, 0x0e, 0x06, 0x02, 0x00, 0x00, 0x00, 0x00 }, /* \ */
	{ 0x00, 0x00, 0x3c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x3c, 0x00, 0x00, 0x00, 0x00 }, /* ] */
	{ 0x10, 0x38, 0x6c, 0xc6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ^ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00 }, /* _ */
	{ 0x30, 0x30, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ` */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x0c, 0x7c, 0xcc, 0xcc, 0xcc, 0x76, 0x00, 0x00, 0x00, 0x00 }, /* a */
	{ 0x00, 0x00, 0xe0, 0x60, 0x60, 0x78, 0x6c, 0x66, 0x66, 0x66, 0x66, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* b */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0xc6, 0xc0, 0xc0, 0xc0, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* c */
	{ 0x00, 0x00, 0x1c, 0x0c, 0x0c, 0x3c, 0x6c, 0xcc, 0xcc, 0xcc, 0xcc, 0x76, 0x00, 0x00, 0x00, 0x00 }, /* d */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0xc6, 0xfe, 0xc0, 0xc0, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* e */
	{ 0x00, 0x00, 0x38, 0x6c, 0x64, 0x60, 0xf0, 0x60, 0x60, 0x60, 0x60, 0xf0, 0x00, 0x00, 0x00, 0x00 }, /* f */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0x7c, 0x0c, 0xcc, 0x78, 0x00 }, /* g */
	{ 0x00, 0x00, 0xe0, 0x60, 0x60, 0x6c, 0x76, 0x66, 0x66, 0x66, 0x66, 0xe6, 0x00, 0x00, 0x00, 0x00 }, /* h */
	{ 0x00, 0x00, 0x18, 0x18, 0x00, 0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x00, 0x00, 0x00, 0x00 }, /* i */
	{ 0x00, 0x00, 0x06, 0x06, 0x00, 0x0e, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x66, 0x66, 0x3c, 0x00 }, /* j */
	{ 0x00, 0x00, 0xe0, 0x60, 0x60, 0x66, 0x6c, 0x78, 0x78, 0x6c, 0x66, 0xe6, 0x00, 0x00, 0x00, 0x00 }, /* k */
	{ 0x00, 0x00, 0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x00, 0x00, 0x00, 0x00 }, /* l */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0xec, 0xfe, 0xd6, 0xd6, 0xd6, 0xd6, 0xc6, 0x00, 0x00, 0x00, 0x00 }, /* m */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0xdc, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00 }, /* n */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* o */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0xdc, 0x66, 0x66, 0x66, 0x66, 0x66, 0x7c, 0x60, 0x60, 0xf0, 0x00 }, /* p */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0x7c, 0x0c, 0x0c, 0x1e, 0x00 }, /* q */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0xdc, 0x76, 0x66, 0x60, 0x60, 0x60, 0xf0, 0x00, 0x00, 0x00, 0x00 }, /* r */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0xc6, 0x60, 0x38, 0x0c, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* s */
	{ 0x00, 0x00, 0x10, 0x30, 0x30, 0xfc, 0x30, 0x30, 0x30, 0x30, 0x36, 0x1c, 0x00, 0x00, 0x00, 0x00 }, /* t */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0x76, 0x00, 0x00, 0x00, 0x00 }, /* u */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3c, 0x18, 0x00, 0x00, 0x00, 0x00 }, /* v */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0xc6, 0xc6, 0xd6, 0xd6, 0xd6, 0xfe, 0x6c, 0x00, 0x00, 0x00, 0x00 }, /* w */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0xc6, 0x6c, 0x38, 0x38, 0x38, 0x6c, 0xc6, 0x00, 0x00, 0x00, 0x00 }, /* x */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x7e, 0x06, 0x0c, 0xf8, 0x00 }, /* y */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0xcc, 0x18, 0x30, 0x60, 0xc6, 0xfe, 0x00, 0x00, 0x00, 0x00 }, /* z */
	{ 0x00, 0x00, 0x0e, 0x18, 0x18, 0x18, 0x70, 0x18, 0x18, 0x18, 0x18, 0x0e, 0x00, 0x00, 0x00, 0x00 }, /* { */
	{ 0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00 }, /* | */
	{ 0x00, 0x00, 0x70, 0x18, 0x18, 0x18, 0x0e, 0x18, 0x18, 0x18, 0x18, 0x70, 0x00, 0x00, 0x00, 0x00 }, /* } */
	{ 0x00, 0x00, 0x76, 0xdc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ~ */
	{ 0x00, 0x00, 0x00, 0x00, 0x10, 0x38, 0x6c, 0xc6, 0xc6, 0xc6, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ⌂ */
	{ 0x00, 0x00, 0x3c, 0x66, 0xc2, 0xc0, 0xc0, 0xc0, 0xc0, 0xc2, 0x66, 0x3c, 0x18, 0x0c, 0x38, 0x00 }, /* Ç */
	{ 0x00, 0x00, 0xcc, 0xcc, 0x00, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0x76, 0x00, 0x00, 0x00, 0x00 }, /* ü */
	{ 0x00, 0x00, 0x0c, 0x18, 0x00, 0x7c, 0xc6, 0xfe, 0xc0, 0xc0, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* é */
	{ 0x00, 0x10, 0x38, 0x6c, 0x00, 0x78, 0x0c, 0x7c, 0xcc, 0xcc, 0xcc, 0x76, 0x00, 0x00, 0x00, 0x00 }, /* â */
	{ 0x00, 0x00, 0x6c, 0x6c, 0x00, 0x78, 0x0c, 0x7c, 0xcc, 0xcc, 0xcc, 0x76, 0x00, 0x00, 0x00, 0x00 }, /* ä */
	{ 0x00, 0x00, 0x60, 0x30, 0x00, 0x78, 0x0c, 0x7c, 0xcc, 0xcc, 0xcc, 0x76, 0x00, 0x00, 0x00, 0x00 }, /* à */
	{ 0x00, 0x38, 0x6c, 0x38, 0x00, 0x78, 0x0c, 0x7c, 0xcc, 0xcc, 0xcc, 0x76, 0x00, 0x00, 0x00, 0x00 }, /* å */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0xc6, 0xc0, 0xc0, 0xc0, 0xc6, 0x7c, 0x18, 0x0c, 0x38, 0x00 }, /* ç */
	{ 0x00, 0x10, 0x38, 0x6c, 0x00, 0x7c, 0xc6, 0xfe, 0xc0, 0xc0, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* ê */
	{ 0x00, 0x00, 0x6c, 0x6c, 0x00, 0x7c, 0xc6, 0xfe, 0xc0, 0xc0, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* ë */
	{ 0x00, 0x00, 0x60, 0x30, 0x00, 0x7c, 0xc6, 0xfe, 0xc0, 0xc0, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* è */
	{ 0x00, 0x00, 0x66, 0x66, 0x00, 0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x00, 0x00, 0x00, 0x00 }, /* ï */
	{ 0x00, 0x10, 0x38, 0x6c, 0x00, 0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x00, 0x00, 0x00, 0x00 }, /* î */
	{ 0x00, 0x00, 0x30, 0x18, 0x00, 0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x00, 0x00, 0x00, 0x00 }, /* ì */
	{ 0x6c, 0x6c, 0x00, 0x10, 0x38, 0x6c, 0xc6, 0xc6, 0xfe, 0xc6, 0xc6, 0xc6, 0x00, 0x00, 0x00, 0x00 }, /* Ä */
	{ 0x38, 0x6c, 0x38, 0x10, 0x38, 0x6c, 0xc6, 0xc6, 0xfe, 0xc6, 0xc6, 0xc6, 0x00, 0x00, 0x00, 0x00 }, /* Å */
	{ 0x0c, 0x18, 0x00, 0xfe, 0x66, 0x62, 0x68, 0x78, 0x68, 0x62, 0x66, 0xfe, 0x00, 0x00, 0x00, 0x00 }, /* É */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0xcc, 0x76, 0x36, 0x7e, 0xd8, 0xd8, 0x6e, 0x00, 0x00, 0x00, 0x00 }, /* æ */
	{ 0x00, 0x00, 0x3e, 0x6c, 0xcc, 0xcc, 0xfe, 0xcc, 0xcc, 0xcc, 0xcc, 0xce, 0x00, 0x00, 0x00, 0x00 }, /* Æ */
	{ 0x00, 0x10, 0x38, 0x6c, 0x00, 0x7c, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* ô */
	{ 0x00, 0x00, 0x6c, 0x6c, 0x00, 0x7c, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* ö */
	{ 0x00, 0x00, 0x60, 0x30, 0x00, 0x7c, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* ò */
	{ 0x00, 0x10, 0x38, 0x6c, 0x00, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0x76, 0x00, 0x00, 0x00, 0x00 }, /* û */
	{ 0x00, 0x00, 0x60, 0x30, 0x00, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0x76, 0x00, 0x00, 0x00, 0x00 }, /* ù */
	{ 0x00, 0x00, 0x6c, 0x6c, 0x00, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x7e, 0x06, 0x0c, 0xf8, 0x00 }, /* ÿ */
	{ 0x6c, 0x6c, 0x00, 0x7c, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* Ö */
	{ 0x6c, 0x6c, 0x00, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* Ü */
	{ 0x00, 0x18, 0x18, 0x3c, 0x66, 0x60, 0x60, 0x60, 0x66, 0x3c, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00 }, /* ¢ */
	{ 0x00, 0x38, 0x6c, 0x64, 0x60, 0xf0, 0x60, 0x60, 0x60, 0x60, 0xe6, 0xfc, 0x00, 0x00, 0x00, 0x00 }, /* £ */
	{ 0x00, 0x00, 0x66, 0x66, 0x3c, 0x18, 0x7e, 0x18, 0x7e, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00 }, /* ¥ */
	{ 0x00, 0x00, 0xfc, 0x66, 0x66, 0x7c, 0x62, 0x66, 0x6f, 0x66, 0x66, 0xf3, 0x00, 0x00, 0x00, 0x00 }, /* ₧ */
	{ 0x00, 0x00, 0x1c, 0x36, 0x32, 0x30, 0x78, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0xe0, 0x00 }, /* ƒ */
	{ 0x00, 0x00, 0x18, 0x30, 0x00, 0x78, 0x0c, 0x7c, 0xcc, 0xcc, 0xcc, 0x76, 0x00, 0x00, 0x00, 0x00 }, /* á */
	{ 0x00, 0x00, 0x0c, 0x18, 0x00, 0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x00, 0x00, 0x00, 0x00 }, /* í */
	{ 0x00, 0x00, 0x0c, 0x18, 0x00, 0x7c, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* ó */
	{ 0x00, 0x00, 0x18, 0x30, 0x00, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0x76, 0x00, 0x00, 0x00, 0x00 }, /* ú */
	{ 0x00, 0x00, 0x76, 0xdc, 0x00, 0xdc, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00, 0x00, 0x00 }, /* ñ */
	{ 0x76, 0xdc, 0x00, 0xc6, 0xe6, 0xf6, 0xfe, 0xde, 0xce, 0xc6, 0xc6, 0xc6, 0x00, 0x00, 0x00, 0x00 }, /* Ñ */
	{ 0x00, 0x3c, 0x6c, 0x6c, 0x3e, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ª */
	{ 0x00, 0x38, 0x6c, 0x6c, 0x38, 0x00, 0x7c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* º */
	{ 0x00, 0x00, 0x30, 0x30, 0x00, 0x30, 0x30, 0x60, 0xc0, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* ¿ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0xc0, 0xc0, 0xc0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ⌐ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0x06, 0x06, 0x06, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ¬ */
	{ 0x00, 0xc0, 0xc0, 0xc2, 0xc6, 0xcc, 0x18, 0x30, 0x60, 0xdc, 0x86, 0x0c, 0x18, 0x3e, 0x00, 0x00 }, /* ½ */
	{ 0x00, 0xc0, 0xc0, 0xc2, 0xc6, 0xcc, 0x18, 0x30, 0x66, 0xce, 0x9e, 0x3e, 0x06, 0x06, 0x00, 0x00 }, /* ¼ */
	{ 0x00, 0x00, 0x18, 0x18, 0x00, 0x18, 0x18, 0x18, 0x3c, 0x3c, 0x3c, 0x18, 0x00, 0x00, 0x00, 0x00 }, /* ¡ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x36, 0x6c, 0xd8, 0x6c, 0x36, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* « */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0xd8, 0x6c, 0x36, 0x6c, 0xd8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* » */
	{ 0x11, 0x44, 0x11, 0x44, 0x11, 0x44, 0x11, 0x44, 0x11, 0x44, 0x11, 0x44, 0x11, 0x44, 0x11, 0x44 }, /* ░ */
	{ 0x55, 0xaa, 0x55, 0xaa, 0x55, 0xaa, 0x55, 0xaa, 0x55, 0xaa, 0x55, 0xaa, 0x55, 0xaa, 0x55, 0xaa }, /* ▒ */
	{ 0xdd, 0x77, 0xdd, 0x77, 0xdd, 0x77, 0xdd, 0x77, 0xdd, 0x77, 0xdd, 0x77, 0xdd, 0x77, 0xdd, 0x77 }, /* ▓ */
	{ 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18 }, /* │ */
	{ 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xf8, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18 }, /* ┤ */
	{ 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xf8, 0x18, 0xf8, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18 }, /* ╡ */
	{ 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0xf6, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36 }, /* ╢ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36 }, /* ╖ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0x18, 0xf8, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18 }, /* ╕ */
	{ 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0xf6, 0x06, 0xf6, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36 }, /* ╣ */
	{ 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36 }, /* ║ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0x06, 0xf6, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36 }, /* ╗ */
	{ 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0xf6, 0x06, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ╝ */
	{ 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ╜ */
	{ 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xf8, 0x18, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ╛ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18 }, /* ┐ */
	{ 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* └ */
	{ 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ┴ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18 }, /* ┬ */
	{ 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x1f, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18 }, /* ├ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ─ */
	{ 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xff, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18 }, /* ┼ */
	{ 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x1f, 0x18, 0x1f, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18 }, /* ╞ */
	{ 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x37, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36 }, /* ╟ */
	{ 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x37, 0x30, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ╚ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0x30, 0x37, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36 }, /* ╔ */
	{ 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0xf7, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ╩ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0xf7, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36 }, /* ╦ */
	{ 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x37, 0x30, 0x37, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36 }, /* ╠ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ═ */
	{ 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0xf7, 0x00, 0xf7, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36 }, /* ╬ */
	{ 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ╧ */
	{ 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ╨ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18 }, /* ╤ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36 }, /* ╥ */
	{ 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ╙ */
	{ 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x1f, 0x18, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ╘ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x18, 0x1f, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18 }, /* ╒ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36 }, /* ╓ */
	{ 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0xff, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36, 0x36 }, /* ╫ */
	{ 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xff, 0x18, 0xff, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18 }, /* ╪ */
	{ 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ┘ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18 }, /* ┌ */
	{ 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }, /* █ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff }, /* ▄ */
	{ 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0 }, /* ▌ */
	{ 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f }, /* ▐ */
	{ 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ▀ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0x76, 0x00, 0x00, 0x00, 0x00 }, /* α */
	{ 0x00, 0x00, 0x3c, 0x66, 0x66, 0x66, 0x6c, 0x66, 0x66, 0x66, 0x66, 0xec, 0x00, 0x00, 0x00, 0x00 }, /* ß */
	{ 0x00, 0x00, 0xfe, 0x66, 0x62, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0xf0, 0x00, 0x00, 0x00, 0x00 }, /* Γ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0x6c, 0x6c, 0x6c, 0x6c, 0x6c, 0x66, 0x00, 0x00, 0x00, 0x00 }, /* π */
	{ 0x00, 0x00, 0xfe, 0xc6, 0x62, 0x30, 0x18, 0x18, 0x30, 0x62, 0xc6, 0xfe, 0x00, 0x00, 0x00, 0x00 }, /* Σ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x7e, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0x78, 0x00, 0x00, 0x00, 0x00 }, /* σ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xf6, 0xc0, 0xc0, 0xc0, 0x00 }, /* µ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x7e, 0x18, 0x18, 0x18, 0x18, 0x18, 0x0e, 0x00, 0x00, 0x00, 0x00 }, /* τ */
	{ 0x00, 0x00, 0x10, 0x7c, 0xd6, 0xd6, 0xd6, 0xd6, 0xd6, 0x7c, 0x10, 0x10, 0x00, 0x00, 0x00, 0x00 }, /* Φ */
	{ 0x00, 0x00, 0x7c, 0xc6, 0xc6, 0xc6, 0xfe, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* Θ */
	{ 0x00, 0x00, 0x7c, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x6c, 0x6c, 0x6c, 0xee, 0x00, 0x00, 0x00, 0x00 }, /* Ω */
	{ 0x00, 0x00, 0x3c, 0x66, 0x30, 0x18, 0x7c, 0xc6, 0xc6, 0xc6, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* δ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0xdb, 0xdb, 0x6e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ∞ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x6c, 0xd6, 0xd6, 0xd6, 0xd6, 0xd6, 0x7c, 0x10, 0x10, 0x10, 0x00 }, /* φ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0xc6, 0xc0, 0x78, 0xc0, 0xc6, 0x7c, 0x00, 0x00, 0x00, 0x00 }, /* ε */
	{ 0x00, 0x00, 0x00, 0x00, 0x7c, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0x00, 0x00, 0x00, 0x00 }, /* ∩ */
	{ 0x00, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0xfe, 0x00, 0x00, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ≡ */
	{ 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x7e, 0x18, 0x18, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ± */
	{ 0x00, 0x00, 0x00, 0x00, 0xe0, 0x38, 0x0e, 0x38, 0xe0, 0x00, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ≥ */
	{ 0x00, 0x00, 0x00, 0x00, 0x0e, 0x38, 0xe0, 0x38, 0x0e, 0x00, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ≤ */
	{ 0x00, 0x00, 0x0e, 0x1b, 0x1b, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18 }, /* ⌠ */
	{ 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xd8, 0xd8, 0xd8, 0x70, 0x00, 0x00, 0x00, 0x00 }, /* ⌡ */
	{ 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x7e, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ÷ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0xdc, 0x00, 0x76, 0xdc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ≈ */
	{ 0x00, 0x38, 0x6c, 0x6c, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ° */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x3c, 0x3c, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ∙ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* · */
	{ 0x00, 0x00, 0x03, 0x03, 0x06, 0x06, 0x06, 0x0c, 0xcc, 0x6c, 0x38, 0x18, 0x00, 0x00, 0x00, 0x00 }, /* √ */
	{ 0x00, 0x00, 0xb0, 0xd8, 0xd8, 0xd8, 0xd8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ⁿ */
	{ 0x00, 0x70, 0xd8, 0x30, 0x60, 0xc8, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /* ² */
	{ 0x00, 0x00, 0x00, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0x00, 0x00, 0x00, 0x00 }, /* ■ */
	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }, /*   */
//[[[end]]]
}};


INTERN unsigned int
NOTHROW_KERNEL(CC libvga_state_text)(void) {
	unsigned int result;
	result = load_vga_mode(&textmode, 0xff);
	if unlikely(result != VGA_STATE_ERROR_SUCCESS)
		goto done;
	result = load_vga_palette(textpal.vp_pal, sizeof(textpal.vp_pal));
	if unlikely(result != VGA_STATE_ERROR_SUCCESS)
		goto done;
	result = load_vga_font(&textfont);
	if unlikely(result != VGA_STATE_ERROR_SUCCESS)
		goto done;
	/* TODO: VESA, etc. */
done:
	return result;
}

DEFINE_PUBLIC_ALIAS(vga_state_save, libvga_state_save);
DEFINE_PUBLIC_ALIAS(vga_state_load, libvga_state_load);
DEFINE_PUBLIC_ALIAS(vga_state_fini, libvga_state_fini);
DEFINE_PUBLIC_ALIAS(vga_state_text, libvga_state_text);

DECL_END

#endif /* !GUARD_LIBVGASTATE_VGASTATE_C */
